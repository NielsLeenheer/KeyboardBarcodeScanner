!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).KeyboardBarcodeScanner=t()}(this,(function(){"use strict";class e{constructor(e){this._events={}}on(e,t){this._events[e]=this._events[e]||[],this._events[e].push(t)}emit(e,...t){let n=this._events[e];n&&n.forEach((e=>{e(...t)}))}}class t{static detect(e){return e.startsWith("http")?"qrcode":e.match(/^[0-9]+$/)&&8==e.length?"ean8":e.match(/^[0-9]+$/)&&12==e.length?"upca":e.match(/^[0-9]+$/)&&13==e.length?"ean13":e.match(/^M[0-9]/)?"aztec-code":e.length>32?"qrcode":void 0}}return class{#e;#t;constructor(t){this.#e=Object.assign({guessSymbology:!1,debug:!1},t||{}),this.#t={keydown:this.#n.bind(this),interval:null,emitter:new e,buffer:"",timestamp:0}}async connect(){this.#i()}async reconnect(){this.#i()}async disconnect(){}async#i(){document.addEventListener("keydown",this.#t.keydown),this.#t.interval=setInterval((()=>this.#s()),50),this.#t.emitter.emit("connected",{type:"keyboard"})}async#r(){document.removeEventListener("keydown",this.#t.keydown),clearInterval(this.#t.interval),this.#t.emitter.emit("disconnected")}#n(e){if("Clear"===e.key&&"NumLock"===e.code)return this.#t.buffer="",void(this.#t.timestamp=e.timeStamp);e.timeStamp-this.#t.timestamp>30&&(this.#a(this.#t.buffer),this.#t.buffer=""),1===e.key.length&&(this.#t.buffer+=e.key),this.#t.timestamp=e.timeStamp}#s(){0!==this.#t.buffer.length&&performance.now()-this.#t.timestamp>50&&(this.#a(this.#t.buffer),this.#t.buffer="")}#a(e){if(e.length>6){let n={value:e};if(this.#e.guessSymbology){let i=t.detect(e);i&&(n.symbology=i,n.guess=!0)}this.#t.emitter.emit("barcode",n)}}addEventListener(e,t){this.#t.emitter.on(e,t)}}}));
